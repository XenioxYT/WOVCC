{% extends "layout.html" %}

{% block title %}Admin Panel - WOVCC | Wickersley Old Village Cricket Club{% endblock %}

{% block description %}Admin Panel - Manage live matches and configuration{% endblock %}

{% block extra_js %}
<script src="/scripts/api-client.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="/scripts/admin-dashboard.js"></script>
<script src="/scripts/admin-events.js"></script>
<script src="/scripts/admin-users.js"></script>
<script src="/scripts/admin-content.js"></script>
<script src="/scripts/admin-sponsors.js"></script>
<script src="/scripts/admin-help.js"></script>
<script src="/scripts/admin-page.js"></script>

<!-- Toggle Switch CSS and Admin Styles -->
<style>
  /* Dashboard Grid */
  .dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }
  
  .stat-card {
    background: white;
    border-radius: 12px;
    padding: 24px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  
  .stat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
  }
  
  .stat-card.wide {
    grid-column: span 2;
  }
  
  @media (max-width: 768px) {
    .stat-card.wide {
      grid-column: span 1;
    }
  }
  
  .stat-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 16px;
  }
  
  .stat-icon svg {
    width: 24px;
    height: 24px;
  }
  
  .stat-content {
    flex: 1;
  }
  
  .stat-label {
    color: var(--text-light);
    font-size: 0.9rem;
    font-weight: 500;
    margin-bottom: 8px;
  }
  
  .stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 4px;
  }
  
  .stat-detail {
    color: var(--text-light);
    font-size: 0.85rem;
  }
  
  .payment-status-item {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .payment-status-badge {
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 0.85rem;
    font-weight: 600;
    text-transform: capitalize;
  }
  
  .payment-status-badge.active {
    background: #d4edda;
    color: #155724;
  }
  
  .payment-status-badge.pending {
    background: #fff3cd;
    color: #856404;
  }
  
  .payment-status-badge.expired {
    background: #f8d7da;
    color: #721c24;
  }
  
  .payment-status-badge.cancelled {
    background: #d6d8db;
    color: #383d41;
  }
  
  .activity-item {
    padding: 12px;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  .activity-item:last-child {
    border-bottom: none;
  }
  
  .activity-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--primary-color);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 0.9rem;
    flex-shrink: 0;
  }
  
  .activity-details {
    flex: 1;
  }
  
  .activity-name {
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 2px;
  }
  
  .activity-date {
    font-size: 0.8rem;
    color: var(--text-light);
  }
  
  /* Admin Tabs */
  .admin-tabs {
    display: flex;
    gap: 10px;
    border-bottom: 2px solid var(--border-color);
    margin-bottom: 30px;
  }
  
  .admin-tab {
    padding: 12px 24px;
    background: none;
    border: none;
    border-bottom: 3px solid transparent;
    font-weight: 600;
    color: var(--text-light);
    cursor: pointer;
    transition: var(--transition);
    font-size: 1rem;
    position: relative;
    top: 2px;
  }
  
  .admin-tab:hover {
    color: var(--primary-color);
  }
  
  .admin-tab.active {
    color: var(--primary-color);
    border-bottom-color: var(--primary-color);
  }
  
  /* Modal */
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    padding: 20px;
    overflow-y: auto;
    animation: fadeIn 0.2s ease-in;
    box-sizing: border-box;
  }
  
  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
  
  @keyframes slideUp {
    from {
      transform: translateY(20px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }
  
  .modal-content {
    background: white;
    border-radius: 12px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    width: 100%;
    max-width: 800px;
    max-height: 90vh;
    overflow-y: auto;
    margin: auto;
    animation: slideUp 0.3s ease-out;
    box-sizing: border-box;
  }
  
  .modal-header {
    padding: 24px 28px;
    border-bottom: 2px solid var(--border-color);
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: linear-gradient(to bottom, var(--secondary-bg), white);
  }
  
  .modal-header h3 {
    color: var(--primary-color);
    font-size: 1.5rem;
    font-weight: 600;
  }
  
  .modal-body {
    padding: 28px;
  }
  
  .modal-close {
    background: none;
    border: none;
    font-size: 28px;
    color: var(--text-light);
    cursor: pointer;
    padding: 0;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: var(--transition);
  }
  
  .modal-close:hover {
    background: var(--accent-color);
    color: white;
    transform: rotate(90deg);
  }
  
  /* Button Icons */
  .btn-icon {
    background: var(--secondary-bg);
    border: 1px solid var(--border-color);
    padding: 10px;
    border-radius: 8px;
    cursor: pointer;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 40px;
    min-height: 40px;
  }
  
  .btn-icon svg {
    width: 20px !important;
    height: 20px !important;
  }
  
  .btn-icon:hover {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(26, 95, 95, 0.2);
  }
  
  .btn-icon-danger:hover {
    background: #dc3545;
    border-color: #dc3545;
    box-shadow: 0 4px 8px rgba(220, 53, 69, 0.2);
  }
  
  /* Modal Form Styles */
  .modal-body .form-group {
    margin-bottom: 22px;
  }
  
  .modal-body .form-label {
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 8px;
    font-size: 0.95rem;
  }
  
  .modal-body .form-input,
  .modal-body select.form-input {
    background: white;
    border: 2px solid var(--border-color);
    padding: 12px 15px;
    font-size: 0.95rem;
    transition: var(--transition);
  }
  
  .modal-body .form-input:hover {
    border-color: var(--primary-light);
  }
  
  .modal-body .form-input:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(26, 95, 95, 0.1);
  }
  
  .modal-body textarea.form-input {
    resize: vertical;
    min-height: 100px;
    line-height: 1.6;
  }
  
  .modal-body input[type="checkbox"] {
    width: 20px;
    height: 20px;
    cursor: pointer;
    accent-color: var(--primary-color);
  }
  
  /* Toggle Switch */
  .toggle-switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
  }
  
  .toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }
  
  .toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: 0.4s;
    border-radius: 34px;
  }
  
  .toggle-slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: 0.4s;
    border-radius: 50%;
  }
  
  input:checked + .toggle-slider {
    background-color: var(--primary-color);
  }
  
  input:checked + .toggle-slider:before {
    transform: translateX(26px);
  }
  
  /* Notification Toast Styles */
  .notification-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10001;
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-width: 400px;
  }
  
  .notification-toast {
    padding: 16px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    font-size: 0.95rem;
    font-weight: 500;
    line-height: 1.4;
    animation: slideInRight 0.3s ease-out;
    transition: opacity 0.3s ease-out, transform 0.3s ease-out;
  }
  
  @keyframes slideInRight {
    from {
      transform: translateX(400px);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  .notification-toast.notification-hide {
    opacity: 0;
    transform: translateX(400px);
  }
  
  .notification-toast.notification-success {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    border-left: 4px solid #065f46;
  }
  
  .notification-toast.notification-error {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    color: white;
    border-left: 4px solid #991b1b;
  }
  
  .notification-toast.notification-warning {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    color: white;
    border-left: 4px solid #92400e;
  }
  
  .notification-toast.notification-info {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
    border-left: 4px solid #1e40af;
  }
  
  @media screen and (max-width: 575px) {
    .notification-container {
      top: 10px;
      right: 10px;
      left: 10px;
      max-width: none;
    }
    
    .notification-toast {
      font-size: 0.9rem;
      padding: 14px 16px;
    }
  }
</style>
{% endblock %}

{% block content %}
  <!-- Page Header -->
  <section class="hero page-hero">
    <div class="hero-content">
      <h1>Admin Panel</h1>
      <p>Manage live match configuration</p>
    </div>
  </section>

  <!-- Access Denied Section -->
  <section id="access-denied-section" style="display: none;">
    <div class="container" style="padding: 60px 20px; text-align: center;">
      <div style="max-width: 500px; margin: 0 auto;">
        <svg style="width: 80px; height: 80px; margin: 0 auto 20px; color: var(--accent-color);" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z" clip-rule="evenodd"/>
        </svg>
        <h2 style="color: var(--text-dark); margin-bottom: 15px;">Access Denied</h2>
        <p style="color: var(--text-light); margin-bottom: 30px;">
          You must be logged in as an administrator to access this page.
        </p>
        <a href="/members" class="btn btn-primary">Go to Login</a>
      </div>
    </div>
  </section>

  <!-- Admin Content -->
  <section id="admin-content" style="display: none;">
    <div class="section">
      <div class="container" style="max-width: 1200px;">
        
        <!-- Admin Tabs -->
        <div class="admin-tabs" style="margin-bottom: 30px;">
          <button class="admin-tab active" data-tab="dashboard">Dashboard</button>
          <button class="admin-tab" data-tab="live-matches">Live Matches</button>
          <button class="admin-tab" data-tab="users" id="users-tab">User Management</button>
          <button class="admin-tab" data-tab="events" id="events-tab">Events</button>
          <button class="admin-tab" data-tab="sponsors" id="sponsors-tab">Sponsors</button>
          <button class="admin-tab" data-tab="content" id="content-tab">Content</button>
          <button class="admin-tab" data-tab="help" id="help-tab">Help
</button>
        </div>
        
        <!-- Dashboard Tab Content -->
        <div id="dashboard-tab-content" class="tab-content">
          <div class="dashboard-grid">
            
            <!-- Stats Cards Row 1 -->
            <div class="stat-card">
              <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <svg fill="white" viewBox="0 0 20 20">
                  <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
                </svg>
              </div>
              <div class="stat-content">
                <div class="stat-label">Total Members</div>
                <div class="stat-value" id="stat-total-members">-</div>
                <div class="stat-detail" id="stat-active-members">- active</div>
              </div>
            </div>
            
            <div class="stat-card">
              <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                <svg fill="white" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                </svg>
              </div>
              <div class="stat-content">
                <div class="stat-label">Upcoming Events</div>
                <div class="stat-value" id="stat-upcoming-events">-</div>
                <div class="stat-detail" id="stat-total-events">- total events</div>
              </div>
            </div>
            
            <div class="stat-card">
              <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                <svg fill="white" viewBox="0 0 20 20">
                  <path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"/>
                </svg>
              </div>
              <div class="stat-content">
                <div class="stat-label">Newsletter Subscribers</div>
                <div class="stat-value" id="stat-newsletter">-</div>
              </div>
            </div>
            
            <div class="stat-card">
              <div class="stat-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                <svg fill="white" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                </svg>
              </div>
              <div class="stat-content">
                <div class="stat-label">Expiring Soon</div>
                <div class="stat-value" id="stat-expiring-soon">-</div>
                <div class="stat-detail">memberships in 30 days</div>
              </div>
            </div>
            
            <!-- Stats Cards Row 2 -->
            <div class="stat-card wide">
              <div class="stat-content">
                <div class="stat-label" style="margin-bottom: 15px; font-size: 1.1rem; font-weight: 600;">Payment Status Breakdown</div>
                <div id="payment-status-chart" style="display: flex; gap: 20px; flex-wrap: wrap;"></div>
              </div>
            </div>
            
            <div class="stat-card wide">
              <div class="stat-content">
                <div class="stat-label" style="margin-bottom: 15px; font-size: 1.1rem; font-weight: 600;">Recent Activity</div>
                <div id="recent-activity" style="max-height: 300px; overflow-y: auto;"></div>
              </div>
            </div>
            
          </div>
        </div>
        
        <!-- Live Matches Tab Content -->
        <div id="live-matches-tab-content" class="tab-content" style="display: none;">
          <div class="card" style="margin-bottom: 30px;">
          <div class="card-body">
            <h3 style="color: var(--primary-color); margin-bottom: 20px;">Live Match Management</h3>
            
            <!-- Toggle Live Section -->
            <div style="margin-bottom: 30px; padding: 20px; background-color: var(--secondary-bg); border-radius: 8px;">
              <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 15px;">
                <div>
                  <h4 style="margin: 0 0 5px 0; color: var(--text-dark);">Live Section Status</h4>
                  <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">
                    Toggle the live match section visibility on the homepage
                  </p>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="live-toggle">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div id="live-status-indicator" style="margin-top: 15px; padding: 10px 15px; border-radius: 6px; font-size: 0.9rem; font-weight: 500;">
                <span id="status-text"></span>
              </div>
            </div>
            
            <!-- Select Match -->
            <div class="form-group" style="margin-bottom: 25px;">
              <label class="form-label" for="match-selector">
                Select Match <span style="color: var(--text-light); font-weight: 400;">(Choose the match currently being played)</span>
              </label>
              <select id="match-selector" class="form-input" style="cursor: pointer;">
                <option value="">No match selected</option>
              </select>
              <div id="selected-match-preview" style="margin-top: 15px; padding: 15px; background-color: var(--secondary-bg); border-radius: 8px; display: none;">
                <h5 style="margin: 0 0 10px 0; color: var(--primary-color); font-size: 0.95rem;">Selected Match:</h5>
                <div id="match-preview-content"></div>
              </div>
            </div>
            
            <!-- Live Widget Info -->
            <div class="form-group" style="margin-bottom: 25px;">
              <label class="form-label">
                Live Score Widget <span style="color: var(--text-light); font-weight: 400;">(Automatic)</span>
              </label>
              <div style="padding: 15px; background-color: #e7f3ff; border-left: 4px solid var(--primary-color); border-radius: 6px;">
                <p style="margin: 0 0 10px 0; color: var(--text-dark); font-size: 0.9rem;">
                  <strong>‚ÑπÔ∏è Play-Cricket Live Scores</strong>
                </p>
                <p style="margin: 0; color: var(--text-light); font-size: 0.85rem; line-height: 1.5;">
                  When you select a match and enable the live section, the Play-Cricket live score widget will automatically display for the selected team. The widget shows real-time scores and updates automatically.
                </p>
              </div>
            </div>
            
            <!-- Optional: External Livestream URL -->
            <div class="form-group" style="margin-bottom: 25px;">
              <label class="form-label" for="livestream-url">
                External Livestream URL <span style="color: var(--text-light); font-weight: 400;">(Optional - YouTube, etc.)</span>
              </label>
              <input 
                type="text" 
                id="livestream-url" 
                class="form-input" 
                placeholder="e.g., https://www.youtube.com/embed/VIDEO_ID"
              >
              <p style="margin-top: 8px; font-size: 0.85rem; color: var(--text-light);">
                üí° Optional: Add a YouTube or other video stream URL. Leave blank to show only Play-Cricket scores.
              </p>
            </div>
            
            <!-- Action Buttons -->
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
              <button id="save-config-btn" class="btn btn-primary">
                Save Configuration
              </button>
              <button id="clear-config-btn" class="btn btn-outline">
                Clear All
              </button>
            </div>
            
            <!-- Last Updated Info -->
            <div id="last-updated-info" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-color); font-size: 0.9rem; color: var(--text-light); display: none;">
              <strong>Last Updated:</strong> <span id="last-updated-time"></span>
            </div>
          </div>
        </div>

        <!-- Instructions -->
        <div class="card">
          <div class="card-body">
            <h3 style="color: var(--primary-color); margin-bottom: 15px;">Instructions</h3>
            <ol style="padding-left: 20px; line-height: 1.8; color: var(--text-dark);">
              <li><strong>Toggle Live Section:</strong> Turn on to show the live match section on the homepage. Turn off to show regular fixtures/results.</li>
              <li><strong>Select Match:</strong> Choose ONE match for the livestream. All of today's matches will automatically show their live scores via Play-Cricket widgets.</li>
              <li><strong>External Livestream (Optional):</strong> Add a YouTube or other video stream URL for the selected match. The livestream will display the match name above the video.</li>
              <li><strong>Save:</strong> Click "Save Configuration" to apply your changes.</li>
              <li><strong>Clear:</strong> Use "Clear All" to reset the configuration and turn off the live section.</li>
            </ol>
            <div style="margin-top: 15px; padding: 15px; background-color: #e7f3ff; border-radius: 8px; color: #0c5460; border-left: 4px solid var(--primary-color);">
              <strong>‚ÑπÔ∏è How it works:</strong> When live mode is enabled, the system automatically displays Play-Cricket widgets for ALL matches scheduled for today. If you add a livestream URL, it will only show for the match you selected.
            </div>
          </div>
        </div>
        </div> <!-- End live-matches-tab-content -->
        
        <!-- Users Tab Content -->
        <div id="users-tab-content" class="tab-content" style="display: none;">
          <!-- Stats Cards -->
          <div id="admin-stats-cards" style="margin-bottom: 30px;">
            <!-- Stats will be loaded here -->
          </div>
          
          <div class="card" style="margin-bottom: 30px;">
            <div class="card-body">
              <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; margin-bottom: 20px;">
                <h3 style="color: var(--primary-color); margin: 0;">User Management</h3>
                
                <!-- Search -->
                <div style="flex: 1; max-width: 400px;">
                  <input
                    type="text"
                    id="user-search"
                    class="form-input"
                    placeholder="Search by name or email..."
                    style="margin: 0;"
                    data-admin-users-search-input="true"
                  >
                </div>
              </div>
              
              <!-- Filters -->
              <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px;">
                <button class="filter-btn active" data-filter="all" data-admin-users-filter="all">
                  All Users
                </button>
                <button class="filter-btn" data-filter="members" data-admin-users-filter="members">
                  Members
                </button>
                <button class="filter-btn" data-filter="active" data-admin-users-filter="active">
                  Active
                </button>
                <button class="filter-btn" data-filter="expired" data-admin-users-filter="expired">
                  Expired
                </button>
                <button class="filter-btn" data-filter="admins" data-admin-users-filter="admins">
                  Admins
                </button>
                <button class="filter-btn" data-filter="non-members" data-admin-users-filter="non-members">
                  Non-Members
                </button>
              </div>
              
              <!-- Users Table -->
              <div id="admin-users-list">
                <!-- Users list will be loaded here -->
              </div>
            </div>
          </div>
        </div> <!-- End users-tab-content -->
        
        <!-- Events Tab Content -->
        <div id="events-tab-content" class="tab-content" style="display: none;">
          <div class="card" style="margin-bottom: 30px;">
            <div class="card-body">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: var(--primary-color); margin: 0;">Events Management</h3>
                <button class="btn btn-primary" data-admin-events-action="open-create-modal">
                  <svg style="width: 18px; height: 18px; margin-right: 8px;" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
                  </svg>
                  Create Event
                </button>
              </div>
              
              <div id="admin-events-list">
                <!-- Events list will be loaded here -->
              </div>
            </div>
          </div>
        </div> <!-- End events-tab-content -->
        
        <!-- Sponsors Tab Content -->
        <div id="sponsors-tab-content" class="tab-content" style="display: none;">
          <div class="card" style="margin-bottom: 30px;">
            <div class="card-body">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                <div>
                  <h3 style="color: var(--primary-color); margin: 0 0 8px 0;">Sponsor Management</h3>
                  <p style="color: var(--text-light); margin: 0; font-size: 0.9rem;">Manage sponsors displayed in the footer band</p>
                </div>
                <button data-admin-sponsors-action="open-create-modal" class="btn btn-primary">
                  <svg style="width: 18px; height: 18px; margin-right: 8px;" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
                  </svg>
                  Add Sponsor
                </button>
              </div>
              
              <!-- Filters and Search -->
              <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; align-items: center;">
                <input 
                  type="text" 
                  id="sponsors-search" 
                  placeholder="Search sponsors..."
                  class="form-input"
                  style="flex: 1; min-width: 250px; max-width: 400px;">
                
                <select id="sponsors-filter" class="form-input" style="width: auto; min-width: 150px;">
                  <option value="all">All Sponsors</option>
                  <option value="active">Active Only</option>
                  <option value="inactive">Inactive Only</option>
                </select>
              </div>
              
              <!-- Sponsors List -->
              <div id="admin-sponsors-list">
                <!-- Sponsors table will be loaded here -->
              </div>
            </div>
          </div>
        </div> <!-- End sponsors-tab-content -->
        
        <!-- Content Tab Content -->
        <div id="content-tab-content" class="tab-content" style="display: none;">
          <div class="card" style="margin-bottom: 30px;">
            <div class="card-body">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div>
                  <h3 style="color: var(--primary-color); margin: 0 0 8px 0;">Content Management</h3>
                  <p style="color: var(--text-light); margin: 0; font-size: 0.9rem;">Edit text content displayed on the site</p>
                </div>
              </div>
              
              <div id="admin-content-list">
                <!-- Content snippets list will be loaded here -->
              </div>
            </div>
          </div>
        </div> <!-- End content-tab-content -->
        
        <!-- Help Tab Content -->
        <div id="help-tab-content" class="tab-content" style="display: none;">
          <div class="card">
            <div class="card-body">
              <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                <svg style="width: 32px; height: 32px; color: var(--primary-color);" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/>
                </svg>
                <div>
                  <h3 style="color: var(--primary-color); margin: 0 0 4px 0;">AI Help Assistant</h3>
                  <p style="color: var(--text-light); margin: 0; font-size: 0.9rem;">Ask me anything about the admin panel features</p>
                </div>
              </div>
              
              <!-- Chat Container -->
              <div id="help-chat-container" style="border: 2px solid var(--border-color); border-radius: 12px; background: var(--secondary-bg); overflow: hidden;">
                <!-- Chat Messages -->
                <div id="help-chat-messages" style="height: 500px; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 16px;">
                  <!-- Welcome message -->
                  <div class="chat-message assistant-message">
                    <div class="message-avatar">
                      <svg style="width: 24px; height: 24px;" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z"/>
                        <path d="M15 7v2a4 4 0 01-4 4H9.828l-1.766 1.767c.28.149.599.233.938.233h2l3 3v-3h2a2 2 0 002-2V9a2 2 0 00-2-2h-1z"/>
                      </svg>
                    </div>
                    <div class="message-content">
                      <p style="margin: 0;">üëã Hi! I'm your AI assistant. I can help you understand how to use the admin panel.</p>
                      <p style="margin: 8px 0 0 0;">Try asking me:</p>
                      <ul style="margin: 8px 0 0 20px; padding: 0; line-height: 1.8;">
                        <li>"How do I create an event?"</li>
                        <li>"How do I edit the homepage text?"</li>
                        <li>"What can I do in the User Management section?"</li>
                        <li>"How do I show a live match?"</li>
                      </ul>
                    </div>
                  </div>
                </div>
                
                <!-- Chat Input -->
                <div style="border-top: 2px solid var(--border-color); padding: 16px; background: white;">
                  <form id="help-chat-form" style="display: flex; gap: 12px;">
                    <input
                      type="text"
                      id="help-chat-input"
                      class="form-input"
                      placeholder="Ask a question about the admin panel..."
                      style="flex: 1; margin: 0;"
                      required
                    >
                    <button type="submit" class="btn btn-primary" id="help-chat-submit" style="white-space: nowrap;">
                      <svg style="width: 18px; height: 18px; margin-right: 6px;" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/>
                      </svg>
                      Send
                    </button>
                  </form>
                  <div id="help-chat-status" style="margin-top: 8px; font-size: 0.85rem; color: var(--text-light); min-height: 20px;"></div>
                </div>
              </div>
            </div>
          </div>
        </div> <!-- End help-tab-content -->

      </div>
    </div>
  </section>
  
  <!-- Event Modal -->
  <div id="event-modal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h3 id="event-modal-title" style="margin: 0;">Create New Event</h3>
        <button class="modal-close" data-admin-events-action="close-event-modal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="event-form">
          <div class="form-group">
            <label class="form-label" for="event-title">Title *</label>
            <input type="text" id="event-title" class="form-input" required>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="event-short-description" style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
              <span>Short Description * (max 255 chars)</span>
              <button
                type="button"
                class="btn btn-outline"
                style="padding:4px 10px;font-size:0.8rem;display:flex;align-items:center;gap:6px;"
                data-admin-events-action="ai-generate-short"
              >
                <svg style="width:14px;height:14px;" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M4 3a1 1 0 011.447-.894l10 5a1 1 0 010 1.788l-10 5A1 1 0 014 14V3z"/>
                </svg>
                AI Short
              </button>
            </label>
            <textarea id="event-short-description" class="form-input" rows="2" maxlength="255" required></textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="event-long-description" style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
              <span>Long Description * (Markdown supported)</span>
              <div style="display:flex;gap:6px;align-items:center;">
                <button
                  type="button"
                  class="btn btn-outline"
                  style="padding:4px 10px;font-size:0.8rem;display:flex;align-items:center;gap:6px;"
                  data-admin-events-action="ai-generate-long"
                >
                  <svg style="width:14px;height:14px;" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M4 3a1 1 0 011.447-.894l10 5a1 1 0 010 1.788l-10 5A1 1 0 014 14V3z"/>
                  </svg>
                  AI Long
                </button>
                <button
                  type="button"
                  class="btn btn-outline"
                  style="padding:4px 10px;font-size:0.8rem;"
                  id="markdown-preview-btn"
                  data-admin-events-action="toggle-markdown-preview"
                >
                  Preview
                </button>
              </div>
            </label>
            <textarea id="event-long-description" class="form-input" rows="6" required></textarea>
            <div id="markdown-preview" style="margin-top: 10px; padding: 15px; background: var(--secondary-bg); border-radius: 8px; border-left: 3px solid var(--primary-color); display: none; min-height: 50px; line-height: 1.6; color: var(--text-dark);"></div>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="event-date">Date *</label>
            <input type="date" id="event-date" class="form-input" required>
            <p style="margin-top: 8px; font-size: 0.85rem; color: var(--text-light);">
              Select the date for this event
            </p>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="event-time">Time (optional)</label>
            <input type="time" id="event-time" class="form-input" placeholder="e.g., 19:00">
            <p style="margin-top: 8px; font-size: 0.85rem; color: var(--text-light);">
              Select the time for this event (leave empty if no specific time)
            </p>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="event-location">Location (optional)</label>
            <input type="text" id="event-location" class="form-input" placeholder="Wickersley Old Village Cricket Club">
          </div>
          
          <div class="form-group">
            <label class="form-label" for="event-category">Category (optional)</label>
            <input type="text" id="event-category" class="form-input" placeholder="e.g., Training, Social, Match Day, Fundraiser">
          </div>
          
          <div class="form-group">
            <label class="form-label" for="event-image">Event Image</label>
            <input
              type="file"
              id="event-image"
              class="form-input"
              accept="image/png,image/jpeg,image/jpg,image/webp"
              data-admin-events-file-input="image"
            >
            <p style="margin-top: 8px; font-size: 0.85rem; color: var(--text-light);">
              Accepted formats: PNG, JPG, WebP. Max size: 5MB. Image will be auto-resized and optimized.
            </p>
            <div id="image-preview-container" style="margin-top: 15px; position: relative; display: none;">
              <img id="image-preview" src="" alt="Preview" style="max-width: 100%; max-height: 300px; border-radius: 8px; display: block;">
              <button
                type="button"
                data-admin-events-action="remove-image"
                style="position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.9); border: none; border-radius: 50%; width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.2);"
              >
                <svg style="width: 20px; height: 20px; color: var(--accent-color);" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                </svg>
              </button>
            </div>
          </div>
          
          <div class="form-group">
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
              <input
                type="checkbox"
                id="event-is-recurring"
                data-admin-events-action="toggle-recurring"
              >
              <span class="form-label" style="margin: 0;">Recurring Event</span>
            </label>
          </div>
          
          <div id="recurring-options" style="display: none; padding: 20px; background: var(--secondary-bg); border-radius: 8px; margin-bottom: 20px; border-left: 3px solid var(--primary-color);">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div class="form-group" style="margin-bottom: 0;">
                <label class="form-label" for="event-recurrence-pattern">Recurrence Pattern</label>
                <select
                  id="event-recurrence-pattern"
                  class="form-input"
                  data-admin-events-action="recurrence-pattern"
                >
                  <option value="daily">Daily</option>
                  <option value="weekly" selected>Weekly</option>
                  <option value="monthly">Monthly</option>
                </select>
              </div>
              
              <div class="form-group" style="margin-bottom: 0;">
                <label class="form-label" for="event-recurrence-end-date">Recurrence End Date</label>
                <input type="date" id="event-recurrence-end-date" class="form-input">
              </div>
            </div>
            <p style="margin-top: 15px; padding: 10px; background: #e7f3ff; border-radius: 6px; font-size: 0.85rem; color: #0c5460; border-left: 3px solid var(--primary-color);">
              <strong>‚ÑπÔ∏è Note:</strong> The event date above will be used as the starting point. The system will generate up to 12 occurrences following the selected pattern until the end date.
            </p>
          </div>
          
          <div class="form-group">
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
              <input type="checkbox" id="event-is-published">
              <span class="form-label" style="margin: 0;">Publish Event (make visible to public)</span>
            </label>
          </div>
          
          <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
            <button
              type="button"
              class="btn btn-outline"
              data-admin-events-action="close-event-modal"
            >
              Cancel
            </button>
            <button type="submit" id="event-submit-btn" class="btn btn-primary">Create Event</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Interested Users Modal -->
  <div id="interested-users-modal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h3 style="margin: 0;">Interested Users</h3>
        <button class="modal-close" data-admin-events-action="close-interested-users-modal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="interested-users-list">
          <!-- Users list will be loaded here -->
        </div>
      </div>
    </div>
  </div>
  
  <!-- Content Edit Modal -->
  <div id="content-modal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h3 id="content-modal-title" style="margin: 0;">Edit Content</h3>
        <button class="modal-close" data-admin-content-action="close-content-modal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="content-form">
          <input type="hidden" id="content-key">
          
          <div class="form-group">
            <label class="form-label" for="content-description">Description</label>
            <input type="text" id="content-description" class="form-input" disabled>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="content-text">Content *</label>
            <textarea id="content-text" class="form-input" rows="8" required></textarea>
            <p style="margin-top: 8px; font-size: 0.85rem; color: var(--text-light);">
              üí° Basic HTML tags are supported (e.g., &lt;br&gt;, &lt;strong&gt;, &lt;em&gt;)
            </p>
          </div>
          
          <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
            <button
              type="button"
              class="btn btn-outline"
              data-admin-content-action="close-content-modal"
            >
              Cancel
            </button>
            <button type="submit" id="content-submit-btn" class="btn btn-primary">Update Content</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <!-- User Edit Modal -->
  <div id="user-modal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 700px;">
      <div class="modal-header">
        <h3 id="user-modal-title" style="margin: 0;">Edit User</h3>
        <button class="modal-close" data-admin-users-action="close-user-modal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="user-form">
          <div class="form-group">
            <label class="form-label" for="user-name">Name *</label>
            <input type="text" id="user-name" class="form-input" required>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="user-email">Email *</label>
            <input type="email" id="user-email" class="form-input" required>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="user-phone">Phone</label>
            <input type="text" id="user-phone" class="form-input" placeholder="Optional contact number">
          </div>
          
          <div class="form-group">
            <label class="form-label" for="user-address-line1">Address Line 1</label>
            <input type="text" id="user-address-line1" class="form-input" placeholder="Street address">
          </div>
          
          <div class="form-group">
            <label class="form-label" for="user-address-line2">Address Line 2</label>
            <input type="text" id="user-address-line2" class="form-input" placeholder="Apartment, suite, etc. (optional)">
          </div>
          
          <div class="form-group">
            <label class="form-label" for="user-city">City</label>
            <input type="text" id="user-city" class="form-input">
          </div>
          
          <div class="form-group">
            <label class="form-label" for="user-postal-code">Postal Code</label>
            <input type="text" id="user-postal-code" class="form-input">
          </div>
          
          <div class="form-group">
            <label class="form-label" for="user-country">Country Code</label>
            <input type="text" id="user-country" class="form-input" maxlength="2" placeholder="ISO (e.g., GB)">
          </div>
          
          <div class="form-group">
            <label class="form-label" for="user-membership-tier">Membership Tier</label>
            <select id="user-membership-tier" class="form-input">
              <option value="Annual Member">Annual Member</option>
              <option value="Social Member">Social Member</option>
              <option value="Junior Member">Junior Member</option>
              <option value="Honorary Member">Honorary Member</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="user-payment-status">Payment Status</label>
            <select id="user-payment-status" class="form-input">
              <option value="pending">Pending</option>
              <option value="active">Active</option>
              <option value="expired">Expired</option>
              <option value="cancelled">Cancelled</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="user-expiry-date">Membership Expiry Date</label>
            <input type="date" id="user-expiry-date" class="form-input">
          </div>
          
          <div class="form-group">
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
              <input type="checkbox" id="user-is-member">
              <span class="form-label" style="margin: 0;">Is Member</span>
            </label>
          </div>
          
          <div class="form-group">
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
              <input type="checkbox" id="user-is-admin">
              <span class="form-label" style="margin: 0;">Is Admin</span>
            </label>
          </div>
          
          <div class="form-group">
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
              <input type="checkbox" id="user-newsletter">
              <span class="form-label" style="margin: 0;">Newsletter Subscriber</span>
            </label>
          </div>
          
          <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
            <button
              type="button"
              class="btn btn-outline"
              data-admin-users-action="close-user-modal"
            >
              Cancel
            </button>
            <button type="submit" id="user-submit-btn" class="btn btn-primary">Update User</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Sponsor Modal -->
  <div id="sponsor-modal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 700px;">
      <div class="modal-header">
        <h3 id="sponsor-modal-title">Create Sponsor</h3>
        <button data-admin-sponsors-action="close-modal" class="modal-close" type="button">&times;</button>
      </div>
      <div class="modal-body">
        <form id="sponsor-form">
          <div class="form-group">
            <label class="form-label" for="sponsor-name">Sponsor Name *</label>
            <input 
              type="text" 
              id="sponsor-name" 
              class="form-input" 
              required 
              placeholder="e.g., Acme Corporation">
          </div>
          
          <div class="form-group">
            <label class="form-label" for="sponsor-website">Website URL</label>
            <input 
              type="url" 
              id="sponsor-website" 
              class="form-input" 
              placeholder="https://example.com">
            <small style="color: var(--text-light); font-size: 0.85rem;">Optional - Opens when sponsor logo is clicked</small>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="sponsor-logo">Sponsor Logo *</label>
            <input 
              type="file" 
              id="sponsor-logo" 
              class="form-input" 
              accept="image/png,image/jpeg,image/jpg,image/webp,image/svg+xml,image/avif">
            <small style="color: var(--text-light); font-size: 0.85rem;">PNG, JPG, WebP, SVG, or AVIF. Max 5MB. Will be converted to WebP and resized to 80px height.</small>
            
            <!-- Logo Preview -->
            <div id="sponsor-logo-preview" style="margin-top: 15px; display: none;">
              <p style="font-size: 0.9rem; font-weight: 600; color: var(--text-dark); margin-bottom: 8px;">Preview:</p>
              <div style="background: #f5f5f5; padding: 20px; border-radius: 8px; text-align: center;">
                <img id="sponsor-logo-preview-img" src="" alt="Logo preview" style="max-height: 80px; max-width: 300px; height: auto; width: auto;">
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="sponsor-display-order">Display Order</label>
            <input 
              type="number" 
              id="sponsor-display-order" 
              class="form-input" 
              min="0" 
              value="0"
              placeholder="0">
            <small style="color: var(--text-light); font-size: 0.85rem;">Lower numbers appear first. Default: 0</small>
          </div>
          
          <div class="form-group">
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
              <input type="checkbox" id="sponsor-is-active" checked>
              <span class="form-label" style="margin: 0;">Active (visible on website)</span>
            </label>
          </div>
          
          <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
            <button type="button" class="btn btn-outline" data-admin-sponsors-action="close-modal">Cancel</button>
            <button type="submit" id="sponsor-submit-btn" class="btn btn-primary">Create Sponsor</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <style>
    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      transition: var(--transition);
    }
    
    .stat-card:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transform: translateY(-2px);
    }
    
    .stat-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    
    .stat-content {
      flex: 1;
    }
    
    .stat-label {
      font-size: 0.85rem;
      color: var(--text-light);
      margin-bottom: 4px;
      font-weight: 500;
    }
    
    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--text-dark);
      line-height: 1;
    }
    
    .stat-subtitle {
      font-size: 0.75rem;
      color: var(--text-light);
      margin-top: 4px;
    }
    
    /* Filter Buttons */
    .filter-btn {
      background: var(--secondary-bg);
      border: 1px solid var(--border-color);
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
      font-weight: 500;
      color: var(--text-dark);
      font-size: 0.9rem;
    }
    
    .filter-btn:hover {
      background: var(--primary-light);
      border-color: var(--primary-color);
      color: var(--primary-color);
    }
    
    .filter-btn.active {
      background: var(--primary-color);
      border-color: var(--primary-color);
      color: white;
    }
    
    /* Loading Spinner */
    .skeleton-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid var(--secondary-bg);
      border-top-color: var(--primary-color);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Chat Interface Styles */
    .chat-message {
      display: flex;
      gap: 12px;
      align-items: flex-start;
      animation: fadeInUp 0.3s ease-out;
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .chat-message.user-message {
      flex-direction: row-reverse;
    }
    
    .message-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    
    .assistant-message .message-avatar {
      background: var(--primary-color);
      color: white;
    }
    
    .user-message .message-avatar {
      background: var(--accent-color);
      color: white;
    }
    
    .message-content {
      flex: 1;
      padding: 12px 16px;
      border-radius: 12px;
      line-height: 1.6;
      max-width: 80%;
    }
    
    .assistant-message .message-content {
      background: white;
      border: 1px solid var(--border-color);
      border-bottom-left-radius: 4px;
    }
    
    .user-message .message-content {
      background: var(--primary-color);
      color: white;
      border-bottom-right-radius: 4px;
    }
    
    /* Markdown styling in chat messages */
    .message-content p {
      margin: 0.5em 0;
    }
    
    .message-content p:first-child {
      margin-top: 0;
    }
    
    .message-content p:last-child {
      margin-bottom: 0;
    }
    
    .message-content h1,
    .message-content h2,
    .message-content h3,
    .message-content h4 {
      margin: 1em 0 0.5em 0;
      font-weight: 600;
    }
    
    .message-content h1:first-child,
    .message-content h2:first-child,
    .message-content h3:first-child,
    .message-content h4:first-child {
      margin-top: 0;
    }
    
    .message-content ul,
    .message-content ol {
      margin: 0.5em 0;
      padding-left: 1.5em;
    }
    
    .message-content li {
      margin: 0.25em 0;
    }
    
    .message-content code {
      background: rgba(0, 0, 0, 0.05);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }
    
    .user-message .message-content code {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .message-content pre {
      background: rgba(0, 0, 0, 0.05);
      padding: 12px;
      border-radius: 6px;
      overflow-x: auto;
      margin: 0.5em 0;
    }
    
    .user-message .message-content pre {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .message-content pre code {
      background: none;
      padding: 0;
    }
    
    .message-content blockquote {
      margin: 0.5em 0;
      padding-left: 1em;
      border-left: 3px solid var(--border-color);
      color: #666;
    }
    
    .user-message .message-content blockquote {
      border-left-color: rgba(255, 255, 255, 0.5);
      color: rgba(255, 255, 255, 0.9);
    }
    
    .message-content a {
      color: var(--accent-color);
      text-decoration: underline;
    }
    
    .user-message .message-content a {
      color: white;
      text-decoration: underline;
    }
    
    .message-content strong {
      font-weight: 600;
    }
    
    .message-content hr {
      border: none;
      border-top: 1px solid var(--border-color);
      margin: 1em 0;
    }
    
    .user-message .message-content hr {
      border-top-color: rgba(255, 255, 255, 0.3);
    }
    
    .chat-loading {
      display: flex;
      gap: 6px;
      padding: 8px;
    }
    
    .chat-loading-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--primary-color);
      animation: chatLoading 1.4s infinite ease-in-out both;
    }
    
    .chat-loading-dot:nth-child(1) {
      animation-delay: -0.32s;
    }
    
    .chat-loading-dot:nth-child(2) {
      animation-delay: -0.16s;
    }
    
    @keyframes chatLoading {
      0%, 80%, 100% {
        transform: scale(0);
        opacity: 0.5;
      }
      40% {
        transform: scale(1);
        opacity: 1;
      }
    }
    
    /* Mobile Responsive Adjustments */
    @media screen and (max-width: 768px) {
      .modal {
        padding: 10px;
        align-items: flex-start;
        padding-top: 20px;
        overflow-y: auto;
      }
      
      .modal-content {
        max-height: 95vh;
        width: 100%;
        margin: 0 auto;
      }
      
      .modal-header {
        padding: 20px;
      }
      
      .modal-header h3 {
        font-size: 1.25rem;
      }
      
      .modal-body {
        padding: 20px;
      }
      
      .admin-tabs {
        flex-wrap: wrap;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      
      .admin-tab {
        padding: 10px 16px;
        font-size: 0.9rem;
        white-space: nowrap;
      }
      
      /* Fix form inputs on mobile */
      .modal-body .form-input,
      .modal-body select.form-input,
      .modal-body textarea.form-input {
        font-size: 16px; /* Prevents zoom on iOS */
        padding: 12px;
      }
      
      /* Stack filter buttons */
      .filter-btn {
        flex: 1 0 auto;
        min-width: 120px;
      }
      
      /* Improve table responsiveness */
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      /* Better spacing for mobile forms */
      .modal-body .form-group {
        margin-bottom: 18px;
      }
      
      /* Improve button sizing */
      .btn-icon {
        min-width: 36px;
        min-height: 36px;
        padding: 8px;
      }
    }
    
    @media screen and (max-width: 575px) {
      .modal {
        padding: 5px;
        padding-top: 10px;
      }
      
      .modal-content {
        max-height: 98vh;
        width: 100%;
        border-radius: 8px;
      }
      
      .modal-header {
        padding: 15px;
      }
      
      .modal-header h3 {
        font-size: 1.1rem;
      }
      
      .modal-body {
        padding: 15px;
      }
      
      .modal-close {
        width: 32px;
        height: 32px;
        font-size: 24px;
      }
      
      .admin-tab {
        padding: 8px 12px;
        font-size: 0.85rem;
      }
      
      .filter-btn {
        padding: 6px 12px;
        font-size: 0.85rem;
        min-width: 100px;
      }
    }
  </style>
{% endblock %}
