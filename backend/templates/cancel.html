{% extends "layout.html" %}

{% block title %}Payment Cancelled - WOVCC{% endblock %}

{% block content %}
<div class="container" style="max-width: 600px; margin: 100px auto; text-align: center;">
    <div class="card" style="padding: 40px;">
        <!-- Animated Icon (spinner -> cross) -->
        <div id="status-icon" style="margin-bottom: 30px;">
            <div class="spinner" style="
                border: 4px solid #f3f3f3;
                border-top: 4px solid #dc3545;
                border-radius: 50%;
                width: 80px;
                height: 80px;
                animation: spin 1s linear infinite;
                margin: 0 auto;
            "></div>
        </div>

        <!-- Status Message -->
        <div id="status-message">
            <h2>Payment Cancelled</h2>
            <p style="color: #666; margin-top: 15px;">Processing cancellation...</p>
        </div>

        <!-- Action Button (hidden initially) -->
        <div id="action-button" style="margin-top: 30px; display: none;">
            <a href="/join" class="btn btn-primary">Try Again</a>
            <a href="/" class="btn btn-secondary" style="margin-left: 10px;">Back to Home</a>
        </div>
    </div>
</div>

<style>
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    @keyframes drawCross {
        0% { stroke-dashoffset: 100; }
        100% { stroke-dashoffset: 0; }
    }

    .cross-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto;
    }

    .cross-icon circle {
        stroke: #dc3545;
        stroke-width: 3;
        fill: none;
    }

    .cross-icon .cross-line {
        stroke: #dc3545;
        stroke-width: 3;
        stroke-linecap: round;
        fill: none;
        stroke-dasharray: 100;
        stroke-dashoffset: 100;
        animation: drawCross 0.5s ease-out forwards;
    }

    .cross-icon .cross-line:nth-child(2) {
        animation-delay: 0.1s;
    }

    .cross-icon .cross-line:nth-child(3) {
        animation-delay: 0.2s;
    }
</style>

<script>
    console.log('[Cancel] Page loaded');

    // Simulate processing delay, then show cancelled message
    setTimeout(() => {
        console.log('[Cancel] Showing cancelled message');
        
        // Replace spinner with cross icon
        const iconContainer = document.getElementById('status-icon');
        iconContainer.innerHTML = `
            <svg class="cross-icon" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="45"/>
                <line class="cross-line" x1="30" y1="30" x2="70" y2="70"/>
                <line class="cross-line" x1="70" y1="30" x2="30" y2="70"/>
            </svg>
        `;

        // Update message
        const messageContainer = document.getElementById('status-message');
        messageContainer.innerHTML = `
            <h2 style="color: #dc3545;">Payment Cancelled</h2>
            <p style="color: #666; margin-top: 15px;">
                Your payment was cancelled and you have not been charged.
            </p>
            <p style="color: #666; margin-top: 10px;">
                No worries! You can try again whenever you're ready.
            </p>
        `;

        // Show action buttons
        document.getElementById('action-button').style.display = 'block';

        // Clear any pending registration data
        console.log('[Cancel] Clearing stored credentials');
        localStorage.removeItem('wovcc_pending_email');
        localStorage.removeItem('wovcc_pending_password');
    }, 1500); // 1.5 second delay for effect
</script>
{% endblock %}
