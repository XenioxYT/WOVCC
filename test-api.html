<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Test - WOVCC | Wickersley Old Village Cricket Club</title>
    <link rel="icon" type="image/png" href="assets/logo.png">
    <link rel="apple-touch-icon" href="assets/logo.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1a5f5f 0%, #0d3d3d 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .test-section h2 {
            color: #1a5f5f;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        button {
            background: #1a5f5f;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #0d3d3d;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .result {
            background: #f5f5f5;
            border-radius: 5px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .success {
            color: #155724;
            background: #d4edda;
            border-left: 4px solid #28a745;
        }
        
        .error {
            color: #721c24;
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        
        .info {
            color: #0c5460;
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #d4a574;
        }
        
        .stat-card .label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .stat-card .value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1a5f5f;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèè WOVCC API Test Page</h1>
        
        <div class="info">
            <strong>Purpose:</strong> Test the updated API client that uses pre-scraped data from <code>scraped_data.json</code>.
            <br><strong>Note:</strong> Make sure the backend API is running on <code>http://localhost:5000</code>
        </div>
        
        <div class="test-section">
            <h2>1. Health Check</h2>
            <button onclick="testHealth()">Test Health Endpoint</button>
            <div id="health-result" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>2. Fetch All Data</h2>
            <button onclick="testFetchAllData()">Fetch All Data (from file)</button>
            <button onclick="clearCache()">Clear Cache</button>
            <div id="fetch-result" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>3. Get Teams</h2>
            <button onclick="testGetTeams()">Get All Teams</button>
            <div id="teams-result" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>4. Get Fixtures</h2>
            <button onclick="testGetFixtures('all')">Get All Fixtures</button>
            <button onclick="testGetFixtures('282728')">Get Vixens Softball 1 Fixtures</button>
            <div id="fixtures-result" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>5. Get Results</h2>
            <button onclick="testGetResults('all', 10)">Get All Results (limit 10)</button>
            <button onclick="testGetResults('282728', 5)">Get Vixens Softball 1 Results (limit 5)</button>
            <div id="results-result" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>6. Match Status</h2>
            <button onclick="testMatchStatus()">Check If Matches Today</button>
            <div id="status-result" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>7. Performance Stats</h2>
            <button onclick="testPerformance()">Run Performance Test</button>
            <div id="perf-result" class="result" style="display: none;"></div>
        </div>
    </div>
    
    <script src="scripts/api-client.js"></script>
    <script>
        // Helper function to display results
        function displayResult(elementId, data, success = true) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${success ? 'success' : 'error'}`;
            element.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }
        
        // Helper function to create stats display
        function displayStats(elementId, stats) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'result success';
            
            let html = '<div class="stats">';
            for (const [key, value] of Object.entries(stats)) {
                html += `
                    <div class="stat-card">
                        <div class="label">${key}</div>
                        <div class="value">${value}</div>
                    </div>
                `;
            }
            html += '</div>';
            element.innerHTML = html;
        }
        
        // Test 1: Health Check
        async function testHealth() {
            try {
                const result = await wovccApi.healthCheck();
                displayResult('health-result', result, result.status === 'ok');
            } catch (error) {
                displayResult('health-result', { error: error.message }, false);
            }
        }
        
        // Test 2: Fetch All Data
        async function testFetchAllData() {
            try {
                const startTime = performance.now();
                const result = await wovccApi._fetchAllData();
                const endTime = performance.now();
                
                const summary = {
                    success: result.success,
                    last_updated: result.last_updated,
                    teams_count: result.teams?.length || 0,
                    fixtures_count: result.fixtures?.length || 0,
                    results_count: result.results?.length || 0,
                    fetch_time_ms: Math.round(endTime - startTime)
                };
                
                displayResult('fetch-result', summary, result.success);
            } catch (error) {
                displayResult('fetch-result', { error: error.message }, false);
            }
        }
        
        // Clear Cache
        function clearCache() {
            wovccApi.clearCache();
            alert('Cache cleared! Next fetch will retrieve fresh data.');
        }
        
        // Test 3: Get Teams
        async function testGetTeams() {
            try {
                const startTime = performance.now();
                const teams = await wovccApi.getTeams();
                const endTime = performance.now();
                
                const result = {
                    count: teams.length,
                    fetch_time_ms: Math.round(endTime - startTime),
                    teams: teams
                };
                
                displayResult('teams-result', result, true);
            } catch (error) {
                displayResult('teams-result', { error: error.message }, false);
            }
        }
        
        // Test 4: Get Fixtures
        async function testGetFixtures(teamId) {
            try {
                const startTime = performance.now();
                const fixtures = await wovccApi.getFixtures(teamId);
                const endTime = performance.now();
                
                const result = {
                    team_filter: teamId,
                    count: fixtures.length,
                    fetch_time_ms: Math.round(endTime - startTime),
                    fixtures: fixtures
                };
                
                displayResult('fixtures-result', result, true);
            } catch (error) {
                displayResult('fixtures-result', { error: error.message }, false);
            }
        }
        
        // Test 5: Get Results
        async function testGetResults(teamId, limit) {
            try {
                const startTime = performance.now();
                const results = await wovccApi.getResults(teamId, limit);
                const endTime = performance.now();
                
                const result = {
                    team_filter: teamId,
                    limit: limit,
                    count: results.length,
                    fetch_time_ms: Math.round(endTime - startTime),
                    results: results
                };
                
                displayResult('results-result', result, true);
            } catch (error) {
                displayResult('results-result', { error: error.message }, false);
            }
        }
        
        // Test 6: Match Status
        async function testMatchStatus() {
            try {
                const startTime = performance.now();
                const hasMatches = await wovccApi.checkMatchStatus();
                const endTime = performance.now();
                
                const result = {
                    has_matches_today: hasMatches,
                    today_date: new Date().toISOString().split('T')[0],
                    fetch_time_ms: Math.round(endTime - startTime)
                };
                
                displayResult('status-result', result, true);
            } catch (error) {
                displayResult('status-result', { error: error.message }, false);
            }
        }
        
        // Test 7: Performance
        async function testPerformance() {
            try {
                const element = document.getElementById('perf-result');
                element.style.display = 'block';
                element.className = 'result';
                element.innerHTML = 'Running performance tests...';
                
                // Clear cache first
                wovccApi.clearCache();
                
                // First fetch (cold cache)
                const start1 = performance.now();
                await wovccApi._fetchAllData();
                const time1 = performance.now() - start1;
                
                // Second fetch (warm cache)
                const start2 = performance.now();
                await wovccApi._fetchAllData();
                const time2 = performance.now() - start2;
                
                // Third fetch (warm cache)
                const start3 = performance.now();
                await wovccApi._fetchAllData();
                const time3 = performance.now() - start3;
                
                // Multiple operations
                const start4 = performance.now();
                await Promise.all([
                    wovccApi.getTeams(),
                    wovccApi.getFixtures(),
                    wovccApi.getResults('all', 10),
                    wovccApi.checkMatchStatus()
                ]);
                const time4 = performance.now() - start4;
                
                const stats = {
                    'First Fetch (cold)': `${Math.round(time1)} ms`,
                    'Second Fetch (cached)': `${Math.round(time2)} ms`,
                    'Third Fetch (cached)': `${Math.round(time3)} ms`,
                    '4 Parallel Operations': `${Math.round(time4)} ms`,
                    'Cache Speedup': `${Math.round(time1 / time2)}x faster`
                };
                
                displayStats('perf-result', stats);
            } catch (error) {
                displayResult('perf-result', { error: error.message }, false);
            }
        }
    </script>
</body>
</html>

